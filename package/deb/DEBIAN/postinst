#!/bin/bash
set -e

echo "Creating casanode user..."
adduser --system --group --home /opt/casanode --uid 150 casanode || true
chown -R casanode:casanode /opt/casanode
chmod +x /opt/casanode/startup.sh

echo "Setting correct permissions for /etc/casanode.conf..."
chown casanode:casanode /etc/casanode.conf
chmod 600 /etc/casanode.conf

echo "Setting correct permissions for /var/log/casanode..."
chown -R casanode:casanode /var/log/casanode
chmod -R 755 /var/log/casanode

echo "Installing node modules..."
npm install --prefix /opt/casanode/app --production

echo "Enabling systemd services..."
systemctl enable casanode.service
systemctl enable casanode-startup.service
systemctl daemon-reload

echo "Starting Casanode service..."
systemctl start casanode.service
